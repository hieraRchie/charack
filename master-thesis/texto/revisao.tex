\chapter{Revisão de Literatura} 
\label{capitulo:revisao}

\section{Mundos pseudo-infinitos}

%-- falar aqui das zilhoes de abordagens para geração de mundos infinitos que nós encontramos. Parece que todo mundo resolveu fazer pesquisa sobre isso de uma hora para outra.

%- p87-greuter (geração de cidades virtuais);
%- LandscapeGeneration (geração de mundos, ruido do Perlin, fractais para relevo, texturizacao, geração de plantas, cidades, nuvens)
%- LindaOndrej2007 (ferramenta para geração de mundo circular, VARIOS ruidos do Perlin, fractais e multifractais, colorização)
%- terrain_generation (geração de terrenos finitos aplicados a um jogo caso de uso)
%- dollins-thesis (geração procedimental de mundos virtuais muito grandes usando quad-trees e divisões estocásticas)
%- dramatic_landscapes (dunas de areia e relevos semelhantes com heighmap)
%- mountains.gi93 (montanhas com rios)
%- p1463-ong (geração de terreno por algoritmo genéricos, não por fractais e afins)

%-- Aqui vai a explicação sobre o artigo frances sobre geração de cidades pseudo-infinitas (nosso artigo semente), aquela engine para geração de mundos virtuais, aquela outra ferramenta para geração de terrenos infinitos.

%-- http://landscapestudio.omgames.co.uk/screenshots.html
%-- http://www.vterrain.org/
%-- http://www.pandromeda.com/products/mojoworldpro.php
%-- http://wwwcg.in.tum.de/Research/Publications/FractalTerrain
%-- http://www.howardzzh.com/research/terrain/
%-- http://www.cs.brown.edu/~scd/world/home.html (exatamente o que queremos fazer)
%-- http://www.earth3d.org/
%-- http://www.planetside.co.uk/terragen/

A geração de conteúdo procedimentais é um assunto antigo no campo da computação gráfica. A aplicação desse tipo de técnica na geração de um mundo virtual completo foi utilizada por ~\cite{infinicity}, cujo objetivo era gerar uma cidade virtual que fosse visualmente interessante e composta por construções complexas, porém cada uma delas sendo criada a partir de elementos mais simples.

Na abordagem utilizada, os autores dividiram o mundo virtual numa grade composta por diversos quadrados, chamados células. As coordenadas de localização de cada célula, em conjunto com uma semente global, são utilizadas como entrada para uma função de hash ~\cite{wangHash}. O resultado dessa função é utilizado como semente para um pseudo gerador de números aleatórios e irá definir todas as características das construções que estão dentro da célula. Dessa forma, o conteúdo de uma célula é sempre o mesmo, independente de quanto o usuário caminhe pelo mundo virtual e faça a célula em questão entrar ou sair do seu campo de visão. A figura ~\ref{fig:greuter_grade} ilustra a divisão do mundo virtual em células.

\begin{figure}
\centering
\resizebox{15cm}{!}{\includegraphics{figuras/greuter_grade.png}}
\caption{Mundo virtual dividido em células. Cada uma delas possui uma semente calculada com base em sua posição e com base uma semente global referente à cidade ~\cite{infinicity}}
\label{fig:greuter_grade}
\end{figure}

Cada uma das construções existentes é gerada pela mescla de polígonos simples escolhidos aleatoriamente. Utilizando um processo iterativo, partindo do topo até a base, em cada iteração o polígono escolhido é mesclado com o polígono anterior e, então, mais um nível (andar) é criado; esse processo garante que a construção, ao longo das iterações, cresça em altura e em largura de uma forma realística. Depois que a geometria da construção está pronta, ela é texturizada com janelas, sendo que o tipo da janela é escolhido aleatoriamente. A figura ~\ref{fig:greuter_predios} ilustra a geração de construções.

\begin{figure}
\centering
\resizebox{15cm}{!}{\includegraphics{figuras/greuter_predios.png}}
\caption{Geração de construções: em andar é gerado pela mescla de polígonos escolhidos e centralizados aleatoriamente ~\cite{infinicity}}
\label{fig:greuter_predios}
\end{figure}

Para garantir o uso racional de recursos computacionais, como memória e processamento, os autores utilizaram o conceito nomeado por eles de preenchimento por {\it view frustum}, que consiste em restringir à geração de conteúdo somente para as células que estão dentro do campo de visão do usuário. A medida que esse anda pela cidade virtual, novas células vão sendo adicionadas ao campo de visão e seu conteúdo é gerado; quando a célula sai do campo de visão, ela é removida da memória e seus recursos são liberados. As células são posicionadas em loops quadrados ao redor do usuário e são consideradas pertencentes ao campo de visão se estão a uma certa distância do usuário e dentro de um ângulo de 120º de visão. A figura ~\ref{fig:greuter_view} ilustra o funcionamento do campo de visão descrito e a figura ~\ref{fig:greuter_cidade} mostra uma cidade virtual gerada.

\begin{figure}
\centering
\resizebox{5cm}{!}{\includegraphics{figuras/greuter_view.png}}
\caption{Campo de visão do usuário: apenas as células visíveis tem o seu conteúdo gerado ~\cite{infinicity}}
\label{fig:greuter_view}
\end{figure}

\begin{figure}
\centering
\resizebox{15cm}{!}{\includegraphics{figuras/greuter_cidade.png}}
\caption{Exemplo de cidade virtual gerada ~\cite{infinicity}}
\label{fig:greuter_cidade}
\end{figure}

Outro trabalho analisado foi o de ~\cite{LandscapeGeneration} para a construção da ferramenta SkyCastle ~\cite{SkyCastle}, uma {\it engine} para jogos online multijogador com suporte à geração de mundos virtuais gerados proceduralmente. No referido trabalho, o autor foca o problema de mundos virtuais cada vez maiores em jogos de computador e aplicações, o que cria a necessidade de desenvolvimento de ferramentas capazes de ajudar na geração de conteúdos realistas para esses mundos. Para a geração de relevo, o autor utiliza procedimentos parametrizados e sistemas baseados em fractais em uma abordagem de camadas: a aplicação adiciona um mapa de ruído (com amplitude reduzida) ao mapa de altura base em cada iteração. Os mapas de ruído são pré-computados e criados através de funções de ruído de Perlin, abordagem semelhante ao método de geração de relevo por deposição de sedimentos, que será abordado em mais detalhes na seção ~\ref{sec:relevo}.

Depois do assunto de criação de relevo, o autor aborda a funcionalidade de texturização da malha gerada. Um dos métodos apresentados é a utilização de uma imagem com proporções muito grandes, que seria capaz de cobrir o mundo inteiro. Embora essa abordagem passa ser útil para cenários pequenos, ela não é viável para terrenos grandes ou mundos virtuais, uma vez que o tamanho da imagem poderia atingir proporções proibitivas. Para contornar esse problema, a abordagem de reticulados é sugerida~\cite{CSHD03}; nessa abordagem, uma célula de textura é criada de tal forma que ao posicionar várias células, uma do lado da outra, o plano gerado apresenta uma texturização contínua e sem falhas. O resultado obtido com essa abordagem é aceitável, porém ele não é visualmente atraente para o usuário final, uma vez que o terreno apresenta uma continuidade que não existiria no mundo real. Para conseguir um resultado visual melhor, o autor sugere a utilização de uma abordagem proposta por ~\cite{LN03}, que consiste na utilização de um conjunto de texturas pré-definidas em formato de borda juntamente com a texturização em reticulados já citada. O funcionamento do algoritmo resume-se em aplicar as texturas em borda sobre um plano já uniformemente texturizado, porém utilizando transparência nas áreas não desenháveis das texturas em borda. Dessa forma, a sobreposição das bordas sobre o plano texturizado irá produzir uma paisagem menos homogênea, o que gera um resultado visual melhor. A figura ~\ref{fig:tiling} ilustra as texturas em forma de borda e a sua utilização na abordagem descrita.

\begin{figure}
\centering
\resizebox{15cm}{!}{\includegraphics{figuras/tiling.png}}
\caption{Terreno texturizado com duas camadas: a inferior sendo um bloco escuro e a superior sendo um conjunto de texturas em formato de borda com transparência ~\cite{LandscapeGeneration}}
\label{fig:tiling}
\end{figure}

Para ornamentar o mundo virtual, o autor cita a utilização de plantas proceduralmente geradas através de três métodos principais: {\it L-System}~\cite{PL90}, geração baseada em componentes ~\cite{LD98} e árvores parametrizadas ~\cite{WP95}. O algoritmo {\it L-System} consiste na geração de elementos a partir da interpretação de uma cadeia de caracteres, sendo que cada um desses caracteres representa uma estrutura geométrica ou operação (rotação, translação, etc); a cadeia de caracteres resultante é obtida a partir da aplicação sucessiva de regras sobre uma cadeia base. O algorítimo de geração baseada em componentes consiste na interpretação de uma árvore de elementos, sendo cada um desses elementos modificável através de parâmetros; cada componente pode possuir filhos e, também, uma descrição de qual é o elemento que pode ser usado como folha da árvore. Por fim, a geração de árvores parametrizadas é conceitualmente semelhantes à geração por componentes, exceto que a geração é orientada a ramificações; cada ramificação da árvore corresponde à um nível de recursão, sendo o tronco da árvore o nível zero; quando um ramo sofre uma divisão, os filhos resultantes dessa divisão herdam algumas características do pai (como resolução), porém eles adquirem características próprias, como o ângulo de curvatura; ao final do processo, através de um estudo dos parâmetros corretos a serem utilizados (como a quantidade de ramos, o nível de recursão, etc), é possível que uma árvore completa seja gerada.

Outro trabalho analisado é a geração de planetas procedurais através de fractais e combinações deles com outros métodos~\cite{LindaOndrej2007}. Na abordagem da autora, o mundo gerado não é infinito, porém ele é esférico e simula a visualização do planeta Terra. Partindo da subdivisão recursiva de um octaedro, a autora cria um mundo esférico que serve como base para a aplicação dos algorítimos de relevo. Através de uma interface, o usuário pode estipular qual algorítimo de relevo ele deseja utilizar, e o resultado desse processo é traduzido em uma lista encadeada que descreve todos os vértices do mundo. Uma lista encadeada foi utilizada para garantir que a malha resultante possa ter seus detalhes aumentados e/ou reduzidos facilmente (através das funções de inserção e remoção de elementos da lista), mesmo que essa estrutura de dados não seja a melhor escolha para busca de um elemento em específico, por exemplo. A utilização de listas encadeadas é importante porque a autora utiliza o conceito de LOD ({\it level of detail}) para garantir um bom desempenho da aplicação. Através dessa técnica, nos polígonos que estão longe do campo de visão do usuário são mostrados em resolução baixa (poucos triângulos), enquanto os polígonos que estão próximos ao usuário são mostrados com resolução alta (muitos triângulos), o que aumenta a riqueza de detalhes dos objetos próximos. Com a utilização da lista encadeada, a inserção/remoção de novos vértices como consequência da atuação do algorítimo de LOD torna-se uma tarefa menos complexa.

\begin{figure}
\centering
\resizebox{15cm}{!}{\includegraphics{figuras/mundo_esferico_relevo.png}}
\caption{Diferentes relevos gerados pela utilização de fractais e suas combinações.~\cite{LindaOndrej2007}}
\label{fig:mundo_esferico_relevo}
\end{figure}

O relevo gerado pela autora é obtido através de diversas técnicas, cada uma com suas peculiaridades e resultados. Dentre as técnicas utilizadas, encontram-se: geração por falhas aleatórias, disposição do ponto médio (incluindo uma variação multifractal) e ruido de Perlin (e suas diversas variações). A figura ~\ref{fig:mundo_esferico_relevo} ilustra os relevos obtidos com essas técnicas. Depois que a malha é gerada, a autora utiliza uma combinação de técnicas para colorir os pontos da falha; as técnicas variam conforme o resultado desejado, porém todas elas são baseadas na interpolação de cores parametrizada pela altura do ponto sendo analisado. Para garantir um aspecto mais real, utiliza-se em algumas técnicas conjuntamente com ruídos e turbulência, como o ruído de Perlin.

Tento em vista que autora explora diversos métodos para geração de relevo, é importante salientar quais foram os resultados obtidos com a utilização de cada um deles frente ao problema de geração de continentes para um mundo esférico. Uma visão mostrando todos os planetas gerados é mostrada na figura ~\ref{fig:mundos_esfericos}. O algorítimo de geração por {\bf falhas aleatórias} produz terrenos que parecem quebrados e diversas ilhas pequenas; de acordo com autora, os resultados obtidos em sua grande maioria são muito aleatórios e na média o algorítimo produz um grande continente e um grande oceano. O algorítimo de {\bf disposição do ponto médio} e sua variação multifractal geram continentes grandes e compactos sem muitas ilhas pequenas, com as deformações geradas sendo uniformes e concentradas no centro dos continentes; embora a variação multifractal do algoritmo produza uma colorização aceitável (tento em vista que há grandes variações de altitude), segundo a autora os resultados não são bons quanto os obtidos com ruído de Perlin. O algorítimo de {\bf ruído de Perlin} e sua variação multifractal apresentam resultados visuais melhores em comparação com as técnicas citadas anteriormente; a comparação entre o planeta gerado apenas com ruído de Perlin e o planeta gerado pela sua variação multifractal mostram a considerável diferença existente entre essas duas abordagens: enquanto a primeira produz relevos com variações de altitude concentradas em determinados lugares, a segunda produz relevos mais realistas com uma distribuição menos concentrada em determinados pontos. Por último, as variações {\it ridged} da geração por {\bf ruído de Perlin} produzem planetas com continentes estreitos e arredondados, algumas vezes gerando baías fechadas; da mesma forma que os resultados anteriores mostraram, uma abordagem multifractal gera um relevo com variações de altitude mais distribuídas ao longo dos continentes.

\begin{figure}
\centering
\resizebox{15cm}{!}{\includegraphics{figuras/mundos_esfericos.png}}
\caption{Planetas gerados com os diversos algorítimos. (a) Geração por falhas aleatórias. (b) Disposição do ponto médio. (c) Disposição do ponto médio multifractal. (d) Ruído de Perlin. (e) Ruído de Persil Multifractal. (f) Ruído de Perlin {\it Ridged}. (g) Ruído de Perlin {\it Ridged} Multifractal.~\cite{LindaOndrej2007}}
\label{fig:mundos_esfericos}
\end{figure}

Outro trabalho analisado foi a geração de terrenos procedimentais em tempo real com a utilização de fractais afetados por erosão ~\cite{terrain_generation}. Conforme ressaltado pelo autor, o aumento do poder de processamento de computadores domésticos possibilitou que jogos de computador façam uso de simulações de erosão em tempo quase real. Utilizando essa premissa, o autor agregou à geração de relevo por fractais novas características decorrentes da aplicação de erosão, o que teve como resultado mapas mais reais e, ao mesmo tempo, customizáveis. Primeiramente, um mapa de altura foi criado a partir de um diagrama de Voronoi, sendo cada um dos vértices do diagrama chamados de {\it pontos de funcionalidade}; o valor de cada célula no mapa de altura é obtido através de uma combinação linear das distâncias entre os pontos de funcionalidade mais próximos. Depois que o mapa de altura é gerado, ele é combinado com um algorítimo de geração de ruído para produzir montanhas menos pontiagudas e, para remover as linhas bem definidas criadas pelo diagrama de Voronoi, um filtro de perturbação ainda é aplicado. A figura ~\ref{fig:erosao_evolucao} ilustra o processo descrito. 

\begin{figure}
\centering
\resizebox{15cm}{!}{\includegraphics{figuras/erosao_evolucao.png}}
\caption{(a) Mapa de altura gerado a partir de um diagrama de Voronoi. (b) Aplicações de funções de ruído em (a). (c) Mapa resultante da aplicação de um filtro de perturbação em (b).~\cite{terrain_generation}}
\label{fig:erosao_evolucao}
\end{figure}

Para a simulação de erosão no mapa de altura gerado, o autor utiliza um método híbrido de duas técnicas de erosão: a termal e a hidráulica. A erosão termal consiste na simulação de sedimentos se desprendendo de áreas mais altas e deslizando para baixo, na base do relevo. Aplicando uma série de otimizações sobre o algorítimo original proposto por ~\cite{MusgraveErosao}, o autor obteve resultados satisfatórios que podem ser utilizados em uma abordagem em tempo real para jogos. A erosão hidráulica simula a deposição de sedimentos causada pelo transporte de materiais dissolvidos num fluxo de água corrente. Em uma comparação entre os dois métodos, a erosão hidráulica apresentou melhores resultados visuais, porém mesmo a sua implementação otimizada não foi mais rápida que a erosão termal otimizada. O autor criou, então, uma mescla entre as duas técnicas, alterando o método de erosão hidráulica para que ele ficasse mais próximo ao método de erosão termal. O resultado obtido é uma técnica capaz de gerar resultados visuais tão bons quanto o método da erosão hidráulica, porém com o desempenho do método de erosão termal, o que permite que a técnica seja utiliza em tempo real em jogos. A figura ~\ref{fig:erosao_ilustracao} ilustra o resultado final obtido pelo autor.

\begin{figure}
\centering
\resizebox{15cm}{!}{\includegraphics{figuras/erosao_ilustracao.png}}
\caption{À direita, renderização de um mapa de altura sem a aplicação de erosão; à esquerda, o mesmo mapa com a aplicação de erosão. ~\cite{terrain_generation}}
\label{fig:erosao_ilustracao}
\end{figure}



\section{Funções de ruído}

-- Como utilizamos muito funções de ruido e afins, falar aqui do Perlin e do Musgrave. Falar bastante do livro deles, porque é uma coisa que é bem relacionada com o nosso trabalho e que a gente vai utilizar bastante.

-- Só utilizamos o noise do Perlin aqui e o conceito de multi-fractal, mas sobre fractais eu vou falar depois.


\section{Geração de relevo}{sec:relevo}

-- Falar aqui das 3 formas que encontramos para geração de relevo através de fractais (deposição de sedimentos, alteração do ponto médio e divisão de não sei o que).

-- Falar também sobre os multifractais que tem no livro do Musgrave, que ele usa para geração de costas de continentes muito bonitas.

